<?php if ($this->postData) { ?>
    <?php
    // check access and generate link for default/user/id
    if ($this->checkUserAccess('default' . Acl::RESOURCE_SEPARATOR . 'user', 'id')) {
        // TODO: Update user model to Doctrine1
        $defaultUserIdUrl = $this->url(
            array('module' => 'default', 'controller' => 'user', 'action' => 'id',
                'user_id' => $this->escape($this->postData['User']['id'])), 'defaultUserId'
        );
    } else {
        $defaultUserIdUrl = '#';
    }
    ?>

    <?php
    if ($this->postCommentData) {
        $commentsCount = count($this->postCommentData);
    } else {
        $commentsCount = 0;
    }
    ?>
    <div class="row m-t-10">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="block block-default">
                <?php
                echo $this->BlockConfigMenu($this->translate("Контент"))->postMenu(
                    $this->escape($this->postData['ID'])
                );
                ?>
                <div class="block-header block-header-info clearfix">
                    <div class="pull-right m-r-15 tooltip-field"
                         data-title="<?php echo $this->translate('Просмотров'); ?>" data-placement="bottom">
                        <i class="fa fa-eye fa-lg"></i>
                        <?php echo $this->escape($this->postData['Views']); ?>
                    </div>
                    <div class="pull-right m-r-15 tooltip-field"
                         data-title="<?php echo $this->translate('Комментарии'); ?>" data-placement="bottom">
                        <i class="fa fa-comments-o fa-lg"></i>
                        <?php echo $commentsCount; ?>
                    </div>
                    <div class="pull-left m-r-15 tooltip-field" data-title="<?php echo $this->translate('Автор'); ?>"
                         data-placement="bottom">
                        <a href="<?php echo $defaultUserIdUrl; ?>" target="_blank">
                            <i class="fa fa-user fa-lg"></i>
                            <?php echo $this->escape($this->postData['User']['login']); ?>
                        </a>
                    </div>
                </div>
                <div class="block-body">
                    <?php if ($this->escape($this->postData['ImageUrl'])) { ?>
                        <div class="m-b-15 center-block text-center">
                            <a href="#" data-toggle="modal" data-target=".post-<?php print $this->postData['ID']; ?>"
                               title="<?php echo $this->escape($this->postData['Name']); ?>" class="">
                                <img class="img-thumbnail img-responsive"
                                     src="<?php echo $this->escape($this->postData['ImageUrl']); ?>"/>
                            </a>
                            <?php echo $this->modal(array(
                                'title' => $this->postData['Name'],
                                'class' => 'post-' . $this->postData['ID'],
                                'content' => '<img src="' . $this->escape($this->postData['ImageUrl']) . '" class="img-responsive img-rounded center-block" alt="">'
                            )); ?>
                        </div>
                    <?php } ?>
                    <div class="block-content-text">
                        <?php
                        echo $this->RenderContentTypeText(
                            $this->postData['Text'], $this->postData['ContentType']['Name']
                        );
                        ?>
                    </div>
                    <div class="button-like-wrapper">
                        <div id="vk-like-button" class="button-like">
                            <!-- VK Like -->
                            <script type="text/javascript" src="//vk.com/js/api/openapi.js?96"></script>
                            <script type="text/javascript">
                                VK.init({apiId: 3649896, onlyWidgets: true});
                            </script>
                            <div id="vk_like"></div>
                            <script type="text/javascript">
                                VK.Widgets.Like("vk_like", {type: "mini", height: 18});
                            </script>
                        </div>
                        <div class="fb-like-button button-like">
                            <!-- Facebook like-->
                            <div id="fb-root"></div>
                            <script>(function (d, s, id) {
                                    var js, fjs = d.getElementsByTagName(s)[0];
                                    if (d.getElementById(id))
                                        return;
                                    js = d.createElement(s);
                                    js.id = id;
                                    js.src = "//connect.facebook.net/ru_RU/all.js#xfbml=1";
                                    fjs.parentNode.insertBefore(js, fjs);
                                }(document, 'script', 'facebook-jssdk'));</script>
                            <div class="fb-like" data-href="<?php echo $this->url() ?>" data-width="450"
                                 data-layout="button_count" data-show-faces="true" data-send="false"></div>
                            <!-- Facebook like END-->
                        </div>
                        <div class="gp-like-button button-like">
                            <div class="g-plusone" data-size="medium"></div>
                            <script type="text/javascript">
                                window.___gcfg = {lang: 'en-GB'};

                                (function () {
                                    var po = document.createElement('script');
                                    po.type = 'text/javascript';
                                    po.async = true;
                                    po.src = 'https://apis.google.com/js/plusone.js';
                                    var s = document.getElementsByTagName('script')[0];
                                    s.parentNode.insertBefore(po, s);
                                })();
                            </script>
                        </div>
                        <div class="tw-like-button button-like">
                            <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
                            <script>!function (d, s, id) {
                                    var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
                                    if (!d.getElementById(id)) {
                                        js = d.createElement(s);
                                        js.id = id;
                                        js.src = p + '://platform.twitter.com/widgets.js';
                                        fjs.parentNode.insertBefore(js, fjs);
                                    }
                                }(document, 'script', 'twitter-wjs');</script>
                        </div>
                        <div class="all-like-button button-like">
                            <!-- AddThis Button BEGIN -->
                            <div class="addthis_toolbox addthis_default_style">
                                <a class="addthis_counter addthis_pill_style"></a>
                            </div>
                            <script type="text/javascript"
                                    src="//s7.addthis.com/js/300/addthis_widget.js#pubid=undefined"></script>
                            <!-- AddThis Button END -->
                        </div>
                    </div>
                </div>
                <div class="block-footer clearfix">
                    <div class="pull-left m-r-15 tooltip-field"
                         data-title="<?php echo $this->translate('Тип контента'); ?>" data-placement="bottom">
                        <i class="fa fa-filter fa-lg"></i>
                        <?php echo $this->escape($this->postData['PostCategory']['Name']); ?>
                    </div>
                    <div class="pull-right m-r-15 tooltip-field"
                         data-title="<?php echo $this->translate('Дата создания'); ?>" data-placement="bottom">
                        <i class="fa fa-calendar fa-lg"></i>
                        <?php echo $this->escape($this->postData['DateCreate']); ?>
                    </div>
                    <?php if ($this->escape($this->postData['DateCreate']) != $this->escape($this->postData['DateEdit'])) : ?>
                        <div class="pull-right m-r-15 tooltip-field"
                             data-title="<?php echo $this->translate('Дата редактирования'); ?>"
                             data-placement="bottom">
                            <i class="fa fa-pencil fa-lg"></i>
                            <?php echo $this->escape($this->postData['DateEdit']); ?>
                        </div>
                    <?php endif; ?>
                </div>
            </div>
        </div>
    </div>

    <?php
    //TODO:Update comment model to Doctrine1
    ?>
    <!-- comments -->
    <?php
    $commentAddAccess = $this->checkUserAccess(
        'default' . Acl::RESOURCE_SEPARATOR . 'comment', 'add'
    );
    ?>

    <!-- post comments list -->
    <div class="row m-t-10">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="block block-default block-ui-bordered comment-block">
                <div class="block-header">
                    <div class="block-title text-uppercase text-bold">
                        <?php echo $this->translate('Комментарии'); ?>
                    </div>
                </div>
                <div class="block-body">
                    <div class="comments" id="post-comments">
                        <?php if ($this->postCommentData) { ?>
                            <?php foreach ($this->postCommentData as $comment): ?>
                                <?php
                                $defaultUserIdUrl = $this->url(
                                    array('module' => 'default', 'controller' => 'user', 'action' => 'id',
                                        'user_id' => $this->escape($comment->user_id)), 'defaultUserId', true
                                );
                                $user_db = new Application_Model_DbTable_User();
                                $user_data = $user_db->getItem($comment->user_id);

                                if ($this->getUserStatus($user_data->date_last_activity) == 'online') {
                                    $user_status_class = 'user-online';
                                } else {
                                    $user_status_class = 'user-offline';
                                }
                                ?>

                                <div class="message-item" id="m7">
                                    <div class="message-inner">
                                        <div class="message-head clearfix">
                                            <div class="avatar pull-left">
                                                <div class="block-user">
                                                    <div
                                                        class="img-wrapper-40-40 overflow-hide img-circle center-block user-avatar tooltip-field <?php echo $user_status_class; ?>"
                                                        data-title="<?php echo $user_data->login; ?>"
                                                        data-placement="bottom">
                                                        <a href="<?php echo $defaultUserIdUrl; ?>" target="_blank">
                                                            <?php echo $this->getUserAvatar(
                                                                $user_data->id, $user_data->avatar_type,
                                                                'media-object img-responsive img-size-40', 40
                                                            ); ?>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="user-detail">
                                                <?php if ($comment->title) { ?>
                                                    <h5 class="text-bold handle">
                                                        <?php echo $comment->title; ?>
                                                    </h5>
                                                <?php } ?>
                                                <div class="post-meta">
                                                    <div class="asker-meta">
                                                        <span class="qa-message-what"></span>
                                                        <span class="qa-message-when">
                                                            <span class="qa-message-when-data">
                                                                <?php echo $comment->date_create; ?>
                                                            </span>
                                                        </span>
                                                        <span class="qa-message-who">
                                                            <span class="qa-message-who-pad"> </span>
                                                            <span class="qa-message-who-data">
                                                                <a href="<?php echo $defaultUserIdUrl; ?>"
                                                                   target="_blank">
                                                                    <?php echo $user_data->login; ?>
                                                                </a>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="qa-message-content">
                                            <?php echo $comment->content; ?>
                                        </div>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        <?php } else { ?>
                            <div class="alert alert-info">
                                <?php echo $this->translate('Для данной записи нет комментариев!'); ?>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ./ post comments list -->

    <!-- post comment form -->
    <div class="row m-t-10">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="block block-default block-ui-bordered">
                <div class="block-header">
                    <div class="block-title text-uppercase text-bold">
                        <?php echo $this->translate('Добавить комментарий'); ?>
                    </div>
                </div>
                <div class="block-body">
                    <?php if ($commentAddAccess) { ?>
                        <?php echo $this->commentAddForm; ?>
                    <?php } else { ?>
                        <div class="alert alert-warning">
                            <?php echo $this->translate(
                                'Добавлять комментарии могут только зарегестированные пользователи!'
                            ); ?>
                        </div>
                    <?php } ?>
                </div>
            </div>
        </div>
    </div>
    <!-- ./ post comment form -->
    <!-- ./ comments -->
<?php } ?>